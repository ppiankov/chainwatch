name: "WordPress investigation"
type: wordpress
aliases: [wp]
steps:
  - command: "curl -sL -D - -o /dev/null --max-time 10 http://localhost/"
    purpose: "check HTTP response chain for redirects"
  - command: "find {{SCOPE}}/wp-includes/ -name '*.php' -newer {{SCOPE}}/wp-includes/version.php -type f 2>/dev/null | head -20"
    purpose: "find recently modified core files"
  - command: "grep -rl 'eval(base64_decode\\|eval(gzinflate\\|eval(str_rot13' {{SCOPE}}/wp-content/ 2>/dev/null | head -20"
    purpose: "search for obfuscated code patterns"
  - command: "ls -la {{SCOPE}}/wp-content/mu-plugins/ 2>/dev/null || echo 'no mu-plugins directory'"
    purpose: "list must-use plugins for unknown entries"
  - command: "find {{SCOPE}}/wp-content/plugins/ -maxdepth 1 -type d | sort"
    purpose: "list installed plugins"
  - command: "find {{SCOPE}}/wp-content/uploads/ -name '*.php' -type f 2>/dev/null | head -20"
    purpose: "find PHP files in uploads directory"
  - command: "cat {{SCOPE}}/.htaccess 2>/dev/null || echo 'no .htaccess'"
    purpose: "check .htaccess for injected rewrite rules"
  - command: "crontab -l 2>/dev/null; cat /var/spool/cron/crontabs/* 2>/dev/null || echo 'no user crontabs accessible'"
    purpose: "check cron jobs for suspicious entries"
  - command: "stat -c '%U:%G %a %n' {{SCOPE}}/wp-config.php 2>/dev/null || echo 'wp-config.php not found'"
    purpose: "check wp-config.php ownership and permissions"
  - command: "awk -F: '$3==0 && $1!=\"root\" {print $1\":\"$3\":\"$7}' /etc/passwd 2>/dev/null"
    purpose: "check for rogue UID 0 users"
