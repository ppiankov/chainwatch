name: "Nginx web server investigation"
type: nginx
aliases: [web]
steps:
  - command: "systemctl status nginx 2>/dev/null || service nginx status 2>/dev/null || echo 'nginx service not found'"
    purpose: "check Nginx service status"
  - command: "nginx -v 2>&1 || echo 'nginx not found'"
    purpose: "identify Nginx version"
  - command: "nginx -t 2>&1 || echo 'config test failed or nginx not found'"
    purpose: "validate Nginx configuration syntax"
  - command: "tail -100 {{SCOPE}}/error.log 2>/dev/null || tail -100 /var/log/nginx/error.log 2>/dev/null || journalctl -u nginx --no-pager -n 100 2>/dev/null || echo 'no error logs found'"
    purpose: "show recent error log entries"
  - command: "tail -50 {{SCOPE}}/access.log 2>/dev/null || tail -50 /var/log/nginx/access.log 2>/dev/null || echo 'no access logs found'"
    purpose: "show recent access log entries"
  - command: "ss -tlnp 2>/dev/null | grep -E ':80\\b|:443\\b|:8080\\b' || netstat -tlnp 2>/dev/null | grep -E ':80\\b|:443\\b|:8080\\b' || echo 'no HTTP ports listening'"
    purpose: "check HTTP/HTTPS listening ports"
  - command: "ps aux | grep '[n]ginx' | head -20"
    purpose: "list Nginx worker processes and resource usage"
  - command: "grep -rn 'upstream' /etc/nginx/conf.d/ /etc/nginx/sites-enabled/ 2>/dev/null | head -20 || echo 'no upstream blocks found'"
    purpose: "check upstream/proxy configuration"
  - command: "find /etc/nginx/ -name '*.conf' -newer /etc/nginx/nginx.conf -type f 2>/dev/null | head -20 || echo 'no recently modified configs'"
    purpose: "find recently modified configuration files"
  - command: "grep -rn 'ssl_certificate' /etc/nginx/ 2>/dev/null | head -10 || echo 'no SSL certificates configured'"
    purpose: "check SSL certificate configuration"
